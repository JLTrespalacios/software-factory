"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PythonGenerator = void 0;
const BaseGenerator_1 = require("../../BaseGenerator");
class PythonGenerator extends BaseGenerator_1.BaseGenerator {
    async generate(config) {
        const files = [
            ...this.getCommonFiles(config),
            this.createRequirementsTxt(config),
            this.createMainPy(config),
            this.createStructure(config)
        ].flat();
        return {
            files,
            instructions: [
                'pip install -r requirements.txt',
                'uvicorn app.main:app --reload'
            ],
            dependencies: {
                "fastapi": "^0.100.0",
                "uvicorn": "^0.23.0"
            }
        };
    }
    createRequirementsTxt(_config) {
        return this.createFile('requirements.txt', `
fastapi==0.103.1
uvicorn==0.23.2
pydantic==2.3.0
python-dotenv==1.0.0
requests==2.31.0
    `.trim());
    }
    createMainPy(config) {
        return this.createFile('app/main.py', `
from fastapi import FastAPI
from app.core.config import settings
from app.api import routes

app = FastAPI(
    title="${config.projectName}",
    description="${config.description || 'Generated by Software Factory AI'}",
    version="1.0.0"
)

@app.get("/")
def read_root():
    return {"message": "Welcome to ${config.projectName}"}

@app.get("/health")
def health_check():
    return {"status": "ok"}

# Include routers
# app.include_router(routes.router)

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
    `.trim());
    }
    createStructure(config) {
        const files = [];
        // Core Config
        files.push(this.createFile('app/core/config.py', `
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    PROJECT_NAME: str = "${config.projectName}"
    API_V1_STR: str = "/api/v1"
    
    class Config:
        env_file = ".env"

settings = Settings()
    `.trim()));
        // Empty Init files
        files.push(this.createFile('app/__init__.py', ''));
        files.push(this.createFile('app/api/__init__.py', ''));
        files.push(this.createFile('app/core/__init__.py', ''));
        // Example Service/Route
        files.push(this.createFile('app/api/routes.py', `
from fastapi import APIRouter

router = APIRouter()

@router.get("/items")
async def read_items():
    return [{"name": "Item 1"}, {"name": "Item 2"}]
    `.trim()));
        return files;
    }
}
exports.PythonGenerator = PythonGenerator;
